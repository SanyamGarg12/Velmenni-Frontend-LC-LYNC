<!--
    <legal_notice>
     MaxLinear, Inc. retains all right, title and interest (including all intellectual
     property rights) in and to this computer program, which is protected by applicable
     intellectual property laws.  Unless you have obtained a separate written license from
     MaxLinear, Inc. or an authorized licensee of MaxLinear, Inc., you are not authorized
     to utilize all or a part of this computer program for any purpose (including
     reproduction, distribution, modification, and compilation into object code), and you
     must immediately destroy or return all copies of this computer program.  If you are
     licensed by MaxLinear, Inc. or an authorized licensee of MaxLinear, Inc., your rights
     to utilize this computer program are limited by the terms of that license.
    
     This computer program contains trade secrets owned by MaxLinear, Inc. and, unless
     authorized by MaxLinear, Inc. in writing, you agree to maintain the confidentiality
     of this computer program and related information and to not disclose this computer
     program and related information to any other person or entity.
    
     Misuse of this computer program or any information contained in it may results in
     violations of applicable law.  MaxLinear, Inc. vigorously enforces its copyright,
     trade secret, patent, contractual, and other legal rights.
    
     THIS COMPUTER PROGRAM IS PROVIDED "AS IS" WITHOUT ANY WARRANTIES, AND 
      MAXLINEAR, INC.
     EXPRESSLY DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING THE 
     WARRANTIES OF
     MERCHANTIBILITY, FITNESS FOR A PARTICULAR PURPOSE, TITLE, AND 
     NONINFRINGEMENT.
    
    ***************************************************************************************
                                            Copyright (c) 2014/2020, MaxLinear, Inc.
    ***************************************************************************************
    </legal_notice>
-->

<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="styles.css">
<script language="JavaScript" src="common.js"></script>
<style>
:root {
  --primary-color: #ff6a00;
  --primary-light: #ff922b;
  --primary-dark: #c43e00;
  --background-color: #fff7f0;
  --card-bg: #fff;
  --text-color: #222;
  --border-color: #ffb380;
  --input-border: #ff922b;
  --shadow: 0 4px 24px rgba(255, 106, 0, 0.10);
  --radius: 18px;
  --tab-active: #fff2e6;
  --tab-inactive: #fff7f0;
  --mgmt-vlan: #c43e00;
  --data-vlan-a: #1b5e20;
  --data-vlan-b: #4a148c;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: var(--background-color);
  color: var(--text-color);
  margin: 0;
  padding: 0;
  min-height: 100vh;
  width: 100vw;
  box-sizing: border-box;
  overflow-y: auto;
}

.card {
  background: var(--card-bg);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  border: 1.5px solid var(--border-color);
  margin: 32px auto 0 auto;
  padding: 40px 3vw 40px 3vw;
  width: 100vw;
  max-width: 1200px;
  box-sizing: border-box;
}

.card-header {
  font-size: 2.1em;
  font-weight: bold;
  color: var(--primary-color);
  margin-bottom: 22px;
  letter-spacing: 1px;
  text-align: left;
}

.tabs {
  display: flex;
  gap: 0;
  margin-bottom: 22px;
  border-bottom: 2px solid var(--border-color);
}
.tab {
  padding: 14px 44px 12px 44px;
  background: var(--tab-inactive);
  color: var(--primary-dark);
  font-weight: 600;
  font-size: 1.15em;
  border: none;
  border-radius: 18px 18px 0 0;
  margin-right: 2px;
  cursor: pointer;
  transition: background 0.2s, color 0.2s;
  outline: none;
}
.tab.active {
  background: var(--tab-active);
  color: var(--primary-color);
  border-bottom: 2px solid var(--primary-color);
}

.current-mode {
  float: right;
  font-size: 1.08em;
  color: var(--primary-color);
  background: #fff2e6;
  border-radius: 10px;
  padding: 8px 28px;
  margin-top: 8px;
  margin-bottom: 16px;
  font-weight: 600;
  border: 1.5px solid var(--primary-color);
}

.mode-content {
  background: #fff7f0;
  border-radius: 0 0 18px 18px;
  box-shadow: 0 2px 8px rgba(255, 106, 0, 0.06);
  padding: 38px 3vw 32px 3vw;
  min-height: 340px;
  margin-top: -2px;
  border-top: none;
  border: 1.5px solid var(--border-color);
  border-top: none;
  display: none;
  animation: fadeIn 0.3s;
}
.mode-content.active {
  display: block;
}
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.vlan-diagram {
  display: flex;
  justify-content: center;
  align-items: center;
  margin-bottom: 22px;
}

.vlan-fields {
  display: flex;
  flex-direction: column;
  gap: 18px;
  margin-bottom: 22px;
  max-width: 500px;
}
.vlan-field {
  display: flex;
  align-items: center;
  gap: 16px;
}
.vlan-label {
  min-width: 210px;
  font-weight: 500;
  font-size: 1.08em;
}
.vlan-label.mgmt { color: var(--mgmt-vlan); }
.vlan-label.data-a { color: var(--data-vlan-a); }
.vlan-label.data-b { color: var(--data-vlan-b); }

input[type="text"] {
  padding: 12px 18px;
  border: 1.5px solid var(--input-border);
  border-radius: 8px;
  font-size: 1.13em;
  width: 180px;
  transition: border-color 0.2s, box-shadow 0.2s;
}
input[type="text"]:focus {
  border-color: var(--primary-color);
  outline: none;
  box-shadow: 0 0 0 2px var(--primary-light);
}
input:disabled {
  background-color: #f5f5f5;
  color: #888888;
  cursor: not-allowed;
}

.valid-tags {
  color: #b36b00;
  font-size: 1.01em;
  margin-bottom: 12px;
  text-align: right;
}

.mode-desc {
  font-size: 1.13em;
  margin-bottom: 22px;
  line-height: 1.6;
}
.mode-desc b {
  color: var(--primary-color);
}

.primary-btn {
  background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
  color: #fff;
  border: none;
  border-radius: 10px;
  padding: 16px 48px;
  font-size: 1.18em;
  font-weight: 600;
  cursor: pointer;
  margin: 24px 0 0 0;
  box-shadow: 0 2px 8px rgba(255, 106, 0, 0.10);
  transition: background 0.2s, box-shadow 0.2s;
}
.primary-btn:hover {
  background: linear-gradient(90deg, var(--primary-dark), var(--primary-color));
  box-shadow: 0 4px 16px rgba(255, 106, 0, 0.18);
}

@media (max-width: 900px) {
  .card {
    max-width: 99vw;
    padding: 10px 1vw 18px 1vw;
  }
  .mode-content {
    padding: 14px 1vw 10px 1vw;
  }
  .vlan-fields {
    max-width: 99vw;
  }
  .vlan-label {
    min-width: 120px;
    font-size: 1em;
  }
}
</style>
<script language="JavaScript" src="common.js"></script>
<script>
function switchTab(tab) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.mode-content').forEach(c => c.classList.remove('active'));
  document.getElementById(tab + '-tab').classList.add('active');
  document.getElementById(tab + '-content').classList.add('active');
  // Update current mode pill
  let modeText = '';
  if(tab==='transparent') modeText = 'Current mode: Transparent';
  if(tab==='access') modeText = 'Current mode: Access Port';
  if(tab==='trunk') modeText = 'Current mode: Trunk Port';
  document.getElementById('current_vlan_mode').textContent = modeText;
}
window.onload = function() {
  var currentMode = '$$VLAN.CVLAN.CURRENT_MODE$$';
  if (currentMode === 'Transparent') switchTab('transparent');
  else if (currentMode === 'Access Port') switchTab('access');
  else if (currentMode === 'Trunk Port') switchTab('trunk');
  else switchTab('transparent');
  // Disable ETHB fields if not enabled
  var ethbEnabled = '$$VLAN.CVLAN.ETHB_ENABLED$$';
  if (ethbEnabled !== 'YES') {
    var ethbFields = document.querySelectorAll('[id*="ethb"], [name*="ETHB"]');
    ethbFields.forEach(function(field) { field.disabled = true; });
  }
  // Disable SDIO/PLC/FW fields if not enabled (if tokens present)
  // ... similar logic for SDIO, PLC, FW ...
};
</script>
</head>
<body>
<div class="card">
  <div class="card-header">VLAN Configuration</div>
  <div class="tabs">
    <button class="tab" id="transparent-tab" onclick="switchTab('transparent')">Transparent</button>
    <button class="tab" id="access-tab" onclick="switchTab('access')">Access Port</button>
    <button class="tab" id="trunk-tab" onclick="switchTab('trunk')">Trunk Port</button>
    <span class="current-mode" id="current_vlan_mode"></span>
  </div>
  <form id="vlan_form" method="POST">
    <input type="hidden" name="CSRFTOKEN" value="$$CSRFTOKEN$$">
    <input type="hidden" name="REDIRECT" value="vlan.html">
    <div class="mode-content" id="transparent-content">
      <div class="mode-desc">
        In this mode, VLAN tagging and filtering is <b>disabled</b>.<br>
        The node is <b>transparent</b> to any tagged frame.
      </div>
      <button class="primary-btn" type="submit" name="SET_TRANSPARENT">Set Transparent Mode</button>
    </div>
    <div class="mode-content" id="access-content">
      <div class="vlan-diagram">
        <svg width="260" height="110" viewBox="0 0 260 110">
          <rect x="100" y="30" width="60" height="40" rx="8" fill="#e3f0ff" stroke="#ff6a00" stroke-width="2"/>
          <text x="130" y="55" text-anchor="middle" alignment-baseline="middle" font-size="13" fill="#ff6a00">This node</text>
          <line x1="130" y1="10" x2="130" y2="30" stroke="#ff6a00" stroke-width="2"/>
          <text x="130" y="8" text-anchor="middle" font-size="12" fill="#ff6a00">G.hn</text>
          <line x1="100" y1="50" x2="60" y2="90" stroke="#4a148c" stroke-width="2"/>
          <text x="50" y="100" font-size="12" fill="#4a148c">Data B</text>
          <text x="60" y="110" font-size="11" fill="#4a148c">ETH B</text>
          <line x1="160" y1="50" x2="200" y2="90" stroke="#1b5e20" stroke-width="2"/>
          <text x="210" y="100" font-size="12" fill="#1b5e20">Data A</text>
          <text x="200" y="110" font-size="11" fill="#1b5e20">ETH A</text>
        </svg>
      </div>
      <div class="vlan-fields">
        <div class="vlan-field">
          <span class="vlan-label mgmt">Management VLAN (used for remote configuration of this node)</span>
          <input type="text" id="vlan_pvid_mgmt_access" name="VLAN.CVLAN.PVID_MGMT" maxlength="10" value="$$VLAN.CVLAN.PVID_MGMT$$"/>
        </div>
        <div class="vlan-field">
          <span class="vlan-label data-a">Data VLAN A (connected to Ethernet A)</span>
          <input type="text" id="vlan_pvid_etha_access" name="VLAN.CVLAN.PVID_ETHA" maxlength="10" value="$$VLAN.CVLAN.PVID_ETHA$$"/>
        </div>
        <div class="vlan-field">
          <span class="vlan-label data-b">Data VLAN B (connected to Ethernet B)</span>
          <input type="text" id="vlan_pvid_ethb_access" name="VLAN.CVLAN.PVID_ETHB" maxlength="10" value="$$VLAN.CVLAN.PVID_ETHB$$" $$VLAN.CVLAN.ETHB_DISABLED$$/>
        </div>
        <!-- SDIO, PLC, FW fields if present -->
        <!-- Example: -->
        <!--
        <div class="vlan-field">
          <span class="vlan-label">SDIO VLAN</span>
          <input type="text" name="VLAN.CVLAN.PVID_SDIO" maxlength="10" value="$$VLAN.CVLAN.PVID_SDIO$$" $$VLAN.CVLAN.SDIO_DISABLED$$/>
        </div>
        <div class="vlan-field">
          <span class="vlan-label">PLC VLAN</span>
          <input type="text" name="VLAN.CVLAN.PVID_PLC" maxlength="10" value="$$VLAN.CVLAN.PVID_PLC$$" $$VLAN.CVLAN.PLC_DISABLED$$/>
        </div>
        <div class="vlan-field">
          <span class="vlan-label">FW VLAN</span>
          <input type="text" name="VLAN.CVLAN.PVID_FW" maxlength="10" value="$$VLAN.CVLAN.PVID_FW$$" $$VLAN.CVLAN.FW_DISABLED$$/>
        </div>
        -->
      </div>
      <div class="valid-tags">Valid tags are $$VLAN.CVLAN.VALID_TAG_RANGE$$</div>
      <div class="mode-desc">
        In this mode, ETH A and ETH B are Access Ports. ETH B is optional.<br>
        VLAN tagging and filtering is <b>enabled</b>.<br>
        The node can only be configured from G.hn using the Management VLAN.<br>
        Traffic in the Ethernet ports is tagged in ingress and untagged in egress.
      </div>
      <button class="primary-btn" type="submit" name="SET_ACCESS">Set Access Port Mode</button>
    </div>
    <div class="mode-content" id="trunk-content">
      <div class="vlan-diagram">
        <!-- SVG for Trunk Port (unchanged) -->
        <svg width="260" height="110" viewBox="0 0 260 110">
          <rect x="100" y="30" width="60" height="40" rx="8" fill="#e3f0ff" stroke="#ff6a00" stroke-width="2"/>
          <text x="130" y="55" text-anchor="middle" alignment-baseline="middle" font-size="13" fill="#ff6a00">This node</text>
          <line x1="130" y1="10" x2="130" y2="30" stroke="#ff6a00" stroke-width="2"/>
          <text x="130" y="8" text-anchor="middle" font-size="12" fill="#ff6a00">G.hn</text>
          <line x1="100" y1="50" x2="60" y2="90" stroke="#222" stroke-width="2"/>
          <text x="50" y="100" font-size="12" fill="#222">ETH B</text>
          <line x1="160" y1="50" x2="200" y2="90" stroke="#222" stroke-width="2"/>
          <text x="210" y="100" font-size="12" fill="#222">ETH A</text>
        </svg>
      </div>
      <div class="vlan-fields">
        <div class="vlan-field">
          <span class="vlan-label mgmt">Management VLAN (used for configuration of this node)</span>
          <input type="text" id="vlan_pvid_mgmt_trunk" name="VLAN.CVLAN.PVID_MGMT" maxlength="10" value="$$VLAN.CVLAN.PVID_MGMT$$"/>
        </div>
        <div class="vlan-field">
          <span class="vlan-label data-a">Allowed tags in ETH A:</span>
          <input type="text" id="vlan_allowed_tags_etha_trunk" name="VLAN.CVLAN.ALLOWED_TAGS_IN_ETHA" value="$$VLAN.CVLAN.ALLOWED_TAGS_IN_ETHA$$"/>
        </div>
        <div class="vlan-field">
          <span class="vlan-label data-b">Allowed tags in ETH B:</span>
          <input type="text" id="vlan_allowed_tags_ethb_trunk" name="VLAN.CVLAN.ALLOWED_TAGS_IN_ETHB" value="$$VLAN.CVLAN.ALLOWED_TAGS_IN_ETHB$$" $$VLAN.CVLAN.ETHB_DISABLED$$/>
        </div>
        <!-- SDIO, PLC, FW fields if present -->
        <!--
        <div class="vlan-field">
          <span class="vlan-label">Allowed tags in SDIO:</span>
          <input type="text" name="VLAN.CVLAN.ALLOWED_TAGS_IN_SDIO" value="$$VLAN.CVLAN.ALLOWED_TAGS_IN_SDIO$$" $$VLAN.CVLAN.SDIO_DISABLED$$/>
        </div>
        <div class="vlan-field">
          <span class="vlan-label">Allowed tags in PLC:</span>
          <input type="text" name="VLAN.CVLAN.ALLOWED_TAGS_IN_PLC" value="$$VLAN.CVLAN.ALLOWED_TAGS_IN_PLC$$" $$VLAN.CVLAN.PLC_DISABLED$$/>
        </div>
        <div class="vlan-field">
          <span class="vlan-label">Allowed tags in FW:</span>
          <input type="text" name="VLAN.CVLAN.ALLOWED_TAGS_IN_FW" value="$$VLAN.CVLAN.ALLOWED_TAGS_IN_FW$$" $$VLAN.CVLAN.FW_DISABLED$$/>
        </div>
        -->
      </div>
      <div class="valid-tags">Valid tags are $$VLAN.CVLAN.VALID_TAG_RANGE$$</div>
      <div class="mode-desc">
        In this mode, ETH A and ETH B are Trunk Ports. ETH B is optional. VLAN filtering is enabled but tagging is disabled.<br>
        A list of allowed tags can be configured in the ETH A and ETH B.<br>
        <b>Note:</b> Add the Management VLAN to the allowed tags to allow management from that port.
      </div>
      <button class="primary-btn" type="submit" name="SET_TRUNK">Set Trunk Port Mode</button>
    </div>
  </form>
</div>
<script>
// Logic for button actions and validation (preserved from previous version)
function onSetTransparentMode() {
  alert('Set Transparent Mode (implement backend call)');
}
function onSetAccessMode() {
  // Validate and submit access mode form
  let mgmt = document.getElementById('vlan_pvid_mgmt_access').value.trim();
  let etha = document.getElementById('vlan_pvid_etha_access').value.trim();
  let ethb = document.getElementById('vlan_pvid_ethb_access').value.trim();
  if (!mgmt || !etha) {
    alert('Management VLAN and Data VLAN A are required.');
    return;
  }
  let vals = [mgmt, etha];
  if (ethb) vals.push(ethb);
  for (let v of vals) {
    let n = parseInt(v);
    if (isNaN(n) || n < 2 || n > 4094) {
      alert('VLAN tags must be in range 2-4094.');
      return;
    }
  }
  alert('Set Access Port Mode (implement backend call)');
}
function onSetTrunkMode() {
  let mgmt = document.getElementById('vlan_pvid_mgmt_trunk').value.trim();
  let tagsA = document.getElementById('vlan_allowed_tags_etha_trunk').value.split(',').map(s=>s.trim()).filter(Boolean);
  let tagsB = document.getElementById('vlan_allowed_tags_ethb_trunk').value.split(',').map(s=>s.trim()).filter(Boolean);
  if (!mgmt) {
    alert('Management VLAN is required.');
    return;
  }
  let n = parseInt(mgmt);
  if (isNaN(n) || n < 2 || n > 4094) {
    alert('Management VLAN must be in range 2-4094.');
    return;
  }
  if (tagsA.length > 16 || tagsB.length > 16) {
    alert('Max 16 tags per port allowed.');
    return;
  }
  for (let v of tagsA.concat(tagsB)) {
    let t = parseInt(v);
    if (isNaN(t) || t < 2 || t > 4094) {
      alert('Tags must be in range 2-4094.');
      return;
    }
  }
  alert('Set Trunk Port Mode (implement backend call)');
}
</script>
</body>
</html>
